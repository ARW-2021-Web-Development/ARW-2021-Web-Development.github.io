---
---
<!DOCTYPE html>
<html lang="en">
{% include head.html title="Search" %}

<body>
  {% include header.html %}
  <script src="https://unpkg.com/vue@next"></script>
  <script src="https://unpkg.com/mitt/dist/mitt.umd.js"></script>

  <div id="app" class="hero is-fullheight-with-navbar">
    <div class="hero-body">
      <div class="columns is-centered is-multiline" style="width: 100%;">
        <div v-for="org in orgList" :key="org.abbr" class="column is-one-fifth">
          <div class="container">
            {% raw %}
            <figure class="image is-square is-fullwidth is-relative is-clickable"
              @click="redirect(`${baseurl}/${org.abbr}`)">
              <img :src="baseurl + org.logo" :alt="`${org.abbr} Logo`">
            </figure>
            <a :href="`${baseurl}/${org.abbr}`" class="button is-fullwidth btn-glass white-btn">{{ org.abbr.toUpperCase() }}</a>
            {% endraw %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const emitter = mitt()
    let orgs = JSON.parse(localStorage.getItem('orgs')) || []
    let query = new URLSearchParams(window.location.search).get('q')
    const search = document.getElementById('search')

    search.onkeyup = e => { emitter.emit('queryChange', search.value) }

    if (!orgs.length) {
      fetch('https://jaredblase.github.io/arw-2021/assets/js/org.json')
        .then(response => response.json())
        .then(data => {
          orgs = data
          localStorage.setItem('orgs', JSON.stringify(data))
        })
    }

    Vue.createApp({
      data: () => {
        return { orgs, query, baseurl: '{{ site.baseurl }}' }
      },
      computed: {
        orgList() {
          return this.query ?
            this.orgs.filter(org => org.abbr.includes(this.query) || org.name.includes(this.query)) : this.orgs
        }
      },
      methods: {
        redirect(link) {
          window.location.assign(link)
        }
      },
      created() {
        emitter.on('queryChange', query => {
          this.query = query
          window.history.replaceState(null, '', `?q=${query}`)
        })
      }
    }).mount('#app')
  </script>
  {% include footer.html %}
</body>

</html>